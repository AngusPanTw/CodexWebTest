# 台股創新高低比較查看器 📈📉

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python](https://img.shields.io/badge/Python-3.6+-blue.svg)](https://www.python.org/downloads/)
[![Platform](https://img.shields.io/badge/Platform-Windows-blue.svg)](https://www.microsoft.com/windows/)

一個完整的台股創新高/創新低資料分析與視覺化工具，從資料擷取、處理到互動式網頁查看的一站式解決方案。

## 🎯 專案特色

### 資料擷取與處理
- **智能快取機制**：避免重複下載相同日期資料，大幅提升執行效率
- **自動資料補齊**：偵測並自動下載缺漏的交易日資料  
- **中文編碼支援**：正確處理 Big5/CP950 編碼的 CSV 檔案
- **Excel 轉 JSON**：自動將 Excel 比較結果轉換為網頁可用的 JSON 格式

### 互動式網頁介面
- **雙版本設計**：完整版（需 Python）+ 離線版（無需環境）
- **響應式設計**：支援桌面與行動裝置瀏覽
- **即時篩選**：日期範圍、股票代號/名稱搜尋
- **表格排序**：點擊欄位標題進行升降序排序（含視覺指示器）
- **資料切換**：創新高/創新低資料即時切換
- **統計資訊**：即時顯示篩選結果統計
- **漲跌幅計算**：自動計算並顯示漲跌幅百分比
- **零門檻使用**：離線版讓任何人都能輕鬆使用

### 一鍵啟動系統
- **自動化部署**：一個批次檔完成所有操作
- **智能伺服器管理**：自動檢測埠號衝突並處理
- **背景程序管理**：完整的程序生命週期管理
- **優雅關閉**：自動清理背景程序，避免殘留

## 🚀 快速開始

### 系統需求

#### 完整版（推薦）
- Windows 10/11
- Python 3.6 或更高版本
- 必要的 Python 套件：`pandas`, `openpyxl`, `requests`

#### 離線版（無需 Python 環境）
- 僅需任何現代瀏覽器（Chrome、Edge、Firefox 等）
- 適合沒有 Python 環境的使用者
- 無需安裝任何額外軟體

### 安裝與執行

#### 方法一：一鍵啟動完整版（推薦）
1. **下載專案**
   ```bash
   git clone <repository-url>
   cd CodexWebTest
   ```

2. **一鍵啟動**
   ```
   雙擊執行：啟動台股分析工具.bat
   ```

3. **瀏覽器自動開啟**
   - 自動轉換 Excel 為 JSON
   - 啟動本地伺服器 (http://localhost:8000)
   - 開啟預設瀏覽器

#### 方法二：離線版使用（無需 Python 環境）
**適合對象**：
- 沒有 Python 環境的使用者
- 只需要查看現有資料的使用者
- 不需要更新資料的使用者

**使用步驟**：
1. **下載專案**
   - 從 GitHub 下載 ZIP 檔案並解壓縮
   - 或使用 `git clone` 下載

2. **直接開啟離線版**
   ```
   雙擊執行：index_standalone.html
   ```

3. **功能完整**
   - ✅ 所有篩選和排序功能
   - ✅ 創新高/低資料切換
   - ✅ 即時搜尋和統計
   - ✅ 響應式介面設計
   - ❌ 無法更新資料（使用既有 JSON 檔案）

> **💡 提示**：離線版使用專案中既有的 JSON 資料檔案，如需最新資料請使用完整版或請有 Python 環境的使用者協助轉換。

## 📊 功能說明

### 資料擷取分析
- **時間範圍**：2025年4月7日至6月20日的交易資料
- **基準期間**：4月7日至5月25日（建立高低點基準）
- **比較期間**：5月26日至6月20日（檢測創新高低）
- **資料來源**：台灣證券交易所 (TWSE)

### 網頁功能
| 功能 | 說明 |
|------|------|
| 資料類型切換 | 創新高 ↔ 創新低 |
| 日期篩選 | 選擇特定交易日 |
| 股票搜尋 | 代號或名稱模糊搜尋 |
| 欄位排序 | 點擊表頭排序（含箭頭指示） |
| 統計資訊 | 即時顯示篩選結果 |
| 漲跌幅計算 | 自動計算相對基準期間的變化 |

## 📁 檔案結構

```
CodexWebTest/
├── 啟動台股分析工具.bat      # 🎯 主要啟動程式（完整版）
├── index.html                 # 🌐 伺服器版網頁（需 Python 環境）
├── index_standalone.html      # 📱 離線版網頁（★ 無需 Python 環境）
├── convert_excel_to_json.py   # 🔄 Excel 轉 JSON 工具
├── tse_stock_price_analyzer_high.py  # 📈 創新高分析
├── tse_stock_price_analyzer_low.py   # 📉 創新低分析
├── otc_stock_price_analyzer.py       # 🏪 上櫃股票分析
├── 使用說明.md               # 📖 詳細使用指南
├── README.md                 # 📄 專案說明
└── output/                   # 📂 輸出資料夾
    ├── cache_high/           # 📈 創新高快取
    ├── cache_low/            # 📉 創新低快取
    ├── *.xlsx               # 📊 Excel 分析結果
    └── *.json               # 🔗 JSON 網頁資料（離線版直接讀取）
```

### 檔案說明
| 檔案 | 適用對象 | 說明 |
|------|----------|------|
| `index_standalone.html` | 🌟 **所有使用者** | 離線版，無需任何環境設定 |
| `啟動台股分析工具.bat` | Python 使用者 | 一鍵啟動完整功能 |
| `index.html` | 開發者 | 伺服器版，需要本地伺服器 |

## 🎨 網頁介面預覽

### 主要功能
- **控制面板**：資料類型、日期篩選、股票搜尋
- **統計資訊**：顯示當前篩選結果統計
- **互動表格**：
  - 🎯 點擊欄位標題排序
  - 🔍 即時搜尋篩選
  - 📊 自動漲跌幅計算
  - 🎨 視覺化資料標示

### 表格欄位說明
| 欄位 | 說明 |
|------|------|
| 代號 | 股票代碼 |
| 名稱 | 股票名稱 |
| 創新日期 | 創新高/低發生日期 |
| 收盤價 | 該日收盤價 |
| 基準價 | 基準期間的最高/最低價 |
| 新高/新低 | 創新高/低的價格 |
| 漲跌幅(%) | 相對基準價的變化百分比 |

## 🔧 技術架構

### 後端處理
- **Python**：資料擷取與分析
- **Pandas**：資料處理與分析
- **OpenPyXL**：Excel 檔案處理
- **Requests**：網路資料下載

### 前端介面
- **HTML5**：語義化結構
- **CSS3**：響應式設計與動畫
- **JavaScript ES6+**：互動功能與資料處理
- **Fetch API**：非同步資料載入

### 系統整合
- **批次檔自動化**：Windows 批次處理
- **PowerShell**：背景程序管理
- **HTTP Server**：Python 內建伺服器
- **JSON API**：前後端資料交換

## 📈 資料處理流程

### 1. 資料擷取階段
```
台灣證券交易所 API → 快取檢查 → CSV 下載 → 編碼處理 → 本地快取
```

### 2. 資料分析階段
```
快取資料 → 價格比較 → 創新高低識別 → Excel 報表 → JSON 轉換
```

### 3. 網頁展示階段
```
JSON 載入 → 表格渲染 → 互動功能 → 即時篩選 → 統計更新
```

## 🎯 使用場景

### 投資分析
- 📊 識別強勢突破股票
- 📉 監控弱勢破底股票
- 📅 特定日期區間分析
- 📈 趨勢強度評估

### 研究用途
- 🔍 市場走勢研究
- 📊 技術分析輔助
- 📈 統計資料整理
- 🎯 客製化篩選

### 不同使用者情境
| 使用者類型 | 推薦版本 | 說明 |
|------------|----------|------|
| 🏢 **辦公室使用者** | 離線版 | 無需安裝 Python，直接使用 |
| 📱 **行動查看** | 離線版 | 可儲存到手機/平板直接開啟 |
| 🔄 **需要更新資料** | 完整版 | 可執行資料擷取和分析 |
| 👨‍💻 **開發者** | 完整版 | 可修改和擴展功能 |

## ⚠️ 注意事項

### 資料來源
- 僅支援台灣證券交易所 (TSE) 上市股票
- 上櫃股票 API 目前有問題，暫不支援
- 資料更新需重新執行資料擷取程式

### 系統需求
- 需要穩定的網路連線（首次下載資料）
- Windows 系統（批次檔相容性）
- Python 環境正確配置

### 使用限制
- 資料僅供參考，投資有風險
- 不構成投資建議
- 建議搭配其他分析工具使用

## 📝 更新記錄

### v2.0.0 (2025-06-23)
- ✨ 完整重構互動式網頁介面
- 🎯 新增一鍵啟動批次檔
- 🔄 改善 Excel 轉 JSON 處理
- 🎨 優化排序與篩選功能
- 🛠️ 修正編碼問題
- 📊 新增統計資訊顯示

### v1.0.0 (2025-04-07)
- 🎉 初始版本發布
- 📈 基本資料擷取功能
- 📊 Excel 報表輸出
- 🔄 快取機制實作

## 📄 授權條款

本專案採用 MIT 授權條款，詳見 LICENSE 檔案。

## 🤝 貢獻指南

歡迎提交 Issue 和 Pull Request 來改善這個專案！

---

**⚡ 快速開始：**
- **有 Python 環境**：雙擊 `啟動台股分析工具.bat` 
- **無 Python 環境**：雙擊 `index_standalone.html` （★ 推薦給大多數使用者）

## 快取機制
為了避免重複下載相同資料，程式採用智能快取機制：

### 快取目錄結構
```
output/
├── cache_low/          # TSE Low 分析快取目錄
│   ├── 20250407.json
│   ├── 20250408.json
│   └── ...
├── cache_high/         # TSE High 分析快取目錄
│   ├── 20250407.json
│   ├── 20250408.json
│   └── ...
├── downloaded_dates_low.txt    # 已下載日期記錄（Low）
└── downloaded_dates_high.txt   # 已下載日期記錄（High）
```

### 快取運作原理
1. **首次執行**：下載所有需要的交易日資料並快取
2. **後續執行**：優先讀取快取，僅下載新增的日期資料
3. **自動補齊**：偵測缺漏日期並自動下載補齊

## 輸出檔案（中文命名）
### TSE Low 分析輸出
- `output/台股最低價紀錄_20250407_20250620.xlsx` - 完整最低價記錄
- `output/台股創新低比較_20250526_20250620.xlsx` - 創新低股票比較
- `output/tse_stock_price_analyzer_low.log` - 執行記錄

### TSE High 分析輸出  
- `output/台股最高價紀錄_20250407_20250620.xlsx` - 完整最高價記錄
- `output/台股創新高比較_20250526_20250620.xlsx` - 創新高股票比較
- `output/tse_stock_price_analyzer_high.log` - 執行記錄

以上檔案儲存在本儲存庫的 `output/` 目錄下，方便在雲端或不同環境使用。
程式執行過程會寫入相對應的 log 檔案以便追蹤下載與比對狀態。

## 執行方式
### 找出創新低個股（TSE Low）
執行以下指令分析在比較期間跌破先前低點的股票：
```bash
python tse_stock_price_analyzer_low.py
```
**首次執行**：會下載並快取所有需要的資料
**後續執行**：直接讀取快取資料，快速完成分析
程式會輸出範例格式：
```
1101,台泥,2025-06-02創新低,收盤價27.70,(基準低點:28.50),新低價25.50
```

### 找出創新高個股（TSE High）
執行以下指令分析在比較期間不斷創新高的個股：
```bash
python tse_stock_price_analyzer_high.py
```
**首次執行**：會下載並快取所有需要的資料
**後續執行**：直接讀取快取資料，快速完成分析
程式會輸出範例格式：
```
1101,台泥,2025-06-02創新高,收盤價30.50,(基準高點:29.80),新高價31.20
```
此腳本會分析 4 月 7 日至 5 月 25 日期間的基準高點，並找出 5 月 26 日至 6 月 20 日期間突破基準高點的股票。分析結果將儲存於 Excel 檔案中，方便後續運用。

## 效能優勢
- **首次執行**：約需 2-3 分鐘下載並快取所有資料
- **後續執行**：僅需數秒即可完成分析（直接讀取快取）
- **資料完整性**：自動檢測並補齊缺漏的交易日資料
- **中文介面**：輸出檔案採用中文命名，易於識別

## 上櫃資料分析（目前暫停）
由於上櫃（OTC）API 存在技術問題，無法正常擷取指定日期的歷史資料，相關功能暫時擱置：

**API 問題說明**：
- 櫃買中心 API 加入日期參數後仍只返回最新交易日資料
- 無法取得歷史指定日期的完整資料
- 因此無法進行歷史比較分析

**暫停功能**：
- ~~`otc_stock_price_analyzer.py`~~ （暫停使用）
- ~~上櫃股票創新低/高分析~~ （暫停開發）

**未來計畫**：
- 等待櫃買中心 API 問題修復
- 或尋找其他可靠的上櫃歷史資料來源
- 屆時將提供與上市股票相同的分析功能
