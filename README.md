# 台股資料擷取專案

本專案示範如何從台灣證券交易所下載每日交易資料並進行比較分析。
程式會以 Big5/CP950 編碼處理 CSV 檔案並過濾無效資料，亦考量個股在特定日期可能無交易的情況。

## 🚀 主要特色
- **智能快取機制**：避免重複下載相同日期資料，大幅提升執行效率
- **中文檔名輸出**：產生易於辨識的中文檔案名稱
- **資料排序**：所有輸出資料依日期自動排序
- **自動補齊**：偵測並自動下載缺漏的交易日資料
- **TSE 標註**：檔案名稱標註 TSE（上市）以利區分

## 專案需求
- 下載台灣證券交易所每日股票資料
- 擷取兩個時間區間的資料：
  1. 2025 年 4 月 7 日起（川普宣布關稅執行後）至 6 月 20 日的所有交易日
- 找出 5 月 26 日至 6 月 20 日期間仍然跌破先前低點的股票（上市股票）
- 找出 5 月 26 日至 6 月 20 日期間持續突破先前最高點的股票（上市股票）
- 處理中文編碼 (Big5/CP950)，並過濾無效資料

## 資料來源
- 下載網址: `https://www.twse.com.tw/exchangeReport/MI_INDEX?response=csv&date=YYYYMMDD&type=ALL`
- 檔案格式: CSV
- 預設編碼: Big5/CP950

## 處理流程
### 上市股票跌破低點分析（TSE Low）
1. **檢查快取**：優先檢查本地快取，避免重複下載
2. 下載指定日期的 CSV 檔（僅下載缺漏日期）
3. 以正確編碼 (Big5/CP950) 讀取資料
4. **快取儲存**：將下載資料儲存至 `output/cache_low/` 目錄
5. 擷取日期、證券代號、名稱、收盤價及最低價
6. 記錄 4 月 7 日至 5 月 25 日期間的最低價
7. 比對 5 月 26 日至 6 月 20 日是否跌破上述低點
8. **排序輸出**：產生依日期排序的中文報表

### 上市股票突破高點分析（TSE High）
1. **檢查快取**：優先檢查本地快取，避免重複下載
2. 下載指定日期的 CSV 檔（僅下載缺漏日期）
3. 以正確編碼 (Big5/CP950) 讀取資料
4. **快取儲存**：將下載資料儲存至 `output/cache_high/` 目錄
5. 擷取日期、證券代號、名稱、收盤價及最高價
6. 記錄 4 月 7 日至 5 月 25 日期間的最高價
7. 比對 5 月 26 日至 6 月 20 日是否突破上述高點
8. **排序輸出**：產生依日期排序的中文報表

### 上櫃股票分析 (目前 API 有問題)
**注意：目前上櫃 API 無法正常擷取指定日期資料，僅能獲取最新交易日資料，因此暫時無法提供上櫃股票的歷史比較分析。**

上櫃股票分析功能暫時擱置，等待 API 問題解決後再行開發。

## 快取機制
為了避免重複下載相同資料，程式採用智能快取機制：

### 快取目錄結構
```
output/
├── cache_low/          # TSE Low 分析快取目錄
│   ├── 20250407.json
│   ├── 20250408.json
│   └── ...
├── cache_high/         # TSE High 分析快取目錄
│   ├── 20250407.json
│   ├── 20250408.json
│   └── ...
├── downloaded_dates_low.txt    # 已下載日期記錄（Low）
└── downloaded_dates_high.txt   # 已下載日期記錄（High）
```

### 快取運作原理
1. **首次執行**：下載所有需要的交易日資料並快取
2. **後續執行**：優先讀取快取，僅下載新增的日期資料
3. **自動補齊**：偵測缺漏日期並自動下載補齊

## 輸出檔案（中文命名）
### TSE Low 分析輸出
- `output/台股最低價紀錄_20250407_20250620.xlsx` - 完整最低價記錄
- `output/台股創新低比較_20250526_20250620.xlsx` - 創新低股票比較
- `output/tse_stock_price_analyzer_low.log` - 執行記錄

### TSE High 分析輸出  
- `output/台股最高價紀錄_20250407_20250620.xlsx` - 完整最高價記錄
- `output/台股創新高比較_20250526_20250620.xlsx` - 創新高股票比較
- `output/tse_stock_price_analyzer_high.log` - 執行記錄

以上檔案儲存在本儲存庫的 `output/` 目錄下，方便在雲端或不同環境使用。
程式執行過程會寫入相對應的 log 檔案以便追蹤下載與比對狀態。

## 執行方式
### 找出創新低個股（TSE Low）
執行以下指令分析在比較期間跌破先前低點的股票：
```bash
python tse_stock_price_analyzer_low.py
```
**首次執行**：會下載並快取所有需要的資料
**後續執行**：直接讀取快取資料，快速完成分析
程式會輸出範例格式：
```
1101,台泥,2025-06-02創新低,收盤價27.70,(基準低點:28.50),新低價25.50
```

### 找出創新高個股（TSE High）
執行以下指令分析在比較期間不斷創新高的個股：
```bash
python tse_stock_price_analyzer_high.py
```
**首次執行**：會下載並快取所有需要的資料
**後續執行**：直接讀取快取資料，快速完成分析
程式會輸出範例格式：
```
1101,台泥,2025-06-02創新高,收盤價30.50,(基準高點:29.80),新高價31.20
```
此腳本會分析 4 月 7 日至 5 月 25 日期間的基準高點，並找出 5 月 26 日至 6 月 20 日期間突破基準高點的股票。分析結果將儲存於 Excel 檔案中，方便後續運用。

## 效能優勢
- **首次執行**：約需 2-3 分鐘下載並快取所有資料
- **後續執行**：僅需數秒即可完成分析（直接讀取快取）
- **資料完整性**：自動檢測並補齊缺漏的交易日資料
- **中文介面**：輸出檔案採用中文命名，易於識別

## 上櫃資料分析（目前暫停）
由於上櫃（OTC）API 存在技術問題，無法正常擷取指定日期的歷史資料，相關功能暫時擱置：

**API 問題說明**：
- 櫃買中心 API 加入日期參數後仍只返回最新交易日資料
- 無法取得歷史指定日期的完整資料
- 因此無法進行歷史比較分析

**暫停功能**：
- ~~`otc_stock_price_analyzer.py`~~ （暫停使用）
- ~~上櫃股票創新低/高分析~~ （暫停開發）

**未來計畫**：
- 等待櫃買中心 API 問題修復
- 或尋找其他可靠的上櫃歷史資料來源
- 屆時將提供與上市股票相同的分析功能
